{"version":3,"file":"broadcastQueryClient-experimental.development.js","sources":["../node_modules/broadcast-channel/dist/es/util.js","../node_modules/broadcast-channel/dist/es/methods/native.js","../node_modules/broadcast-channel/dist/es/oblivious-set.js","../node_modules/broadcast-channel/dist/es/options.js","../node_modules/broadcast-channel/dist/es/methods/indexed-db.js","../node_modules/broadcast-channel/dist/es/methods/localstorage.js","../node_modules/broadcast-channel/dist/es/methods/simulate.js","../node_modules/broadcast-channel/dist/es/method-chooser.js","../node_modules/broadcast-channel/dist/es/broadcast-channel.js","../src/broadcastQueryClient-experimental/index.ts"],"sourcesContent":["/**\n * returns true if the given object is a promise\n */\nexport function isPromise(obj) {\n  if (obj && typeof obj.then === 'function') {\n    return true;\n  } else {\n    return false;\n  }\n}\nexport function sleep(time) {\n  if (!time) time = 0;\n  return new Promise(function (res) {\n    return setTimeout(res, time);\n  });\n}\nexport function randomInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n/**\n * https://stackoverflow.com/a/8084248\n */\n\nexport function randomToken() {\n  return Math.random().toString(36).substring(2);\n}\nvar lastMs = 0;\nvar additional = 0;\n/**\n * returns the current time in micro-seconds,\n * WARNING: This is a pseudo-function\n * Performance.now is not reliable in webworkers, so we just make sure to never return the same time.\n * This is enough in browsers, and this function will not be used in nodejs.\n * The main reason for this hack is to ensure that BroadcastChannel behaves equal to production when it is used in fast-running unit tests.\n */\n\nexport function microSeconds() {\n  var ms = new Date().getTime();\n\n  if (ms === lastMs) {\n    additional++;\n    return ms * 1000 + additional;\n  } else {\n    lastMs = ms;\n    additional = 0;\n    return ms * 1000;\n  }\n}\n/**\n * copied from the 'detect-node' npm module\n * We cannot use the module directly because it causes problems with rollup\n * @link https://github.com/iliakan/detect-node/blob/master/index.js\n */\n\nexport var isNode = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';","import { microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nexport var type = 'native';\nexport function create(channelName) {\n  var state = {\n    messagesCallback: null,\n    bc: new BroadcastChannel(channelName),\n    subFns: [] // subscriberFunctions\n\n  };\n\n  state.bc.onmessage = function (msg) {\n    if (state.messagesCallback) {\n      state.messagesCallback(msg.data);\n    }\n  };\n\n  return state;\n}\nexport function close(channelState) {\n  channelState.bc.close();\n  channelState.subFns = [];\n}\nexport function postMessage(channelState, messageJson) {\n  channelState.bc.postMessage(messageJson, false);\n}\nexport function onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  /**\n   * in the electron-renderer, isNode will be true even if we are in browser-context\n   * so we also check if window is undefined\n   */\n  if (isNode && typeof window === 'undefined') return false;\n\n  if (typeof BroadcastChannel === 'function') {\n    if (BroadcastChannel._pubkey) {\n      throw new Error('BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill');\n    }\n\n    return true;\n  } else return false;\n}\nexport function averageResponseTime() {\n  return 150;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","/**\n * this is a set which automatically forgets\n * a given entry when a new entry is set and the ttl\n * of the old one is over\n * @constructor\n */\nvar ObliviousSet = function ObliviousSet(ttl) {\n  var set = new Set();\n  var timeMap = new Map();\n  this.has = set.has.bind(set);\n\n  this.add = function (value) {\n    timeMap.set(value, now());\n    set.add(value);\n\n    _removeTooOldValues();\n  };\n\n  this.clear = function () {\n    set.clear();\n    timeMap.clear();\n  };\n\n  function _removeTooOldValues() {\n    var olderThen = now() - ttl;\n    var iterator = set[Symbol.iterator]();\n\n    while (true) {\n      var value = iterator.next().value;\n      if (!value) return; // no more elements\n\n      var time = timeMap.get(value);\n\n      if (time < olderThen) {\n        timeMap[\"delete\"](value);\n        set[\"delete\"](value);\n      } else {\n        // we reached a value that is not old enough\n        return;\n      }\n    }\n  }\n};\n\nfunction now() {\n  return new Date().getTime();\n}\n\nexport default ObliviousSet;","export function fillOptionsWithDefaults() {\n  var originalOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var options = JSON.parse(JSON.stringify(originalOptions)); // main\n\n  if (typeof options.webWorkerSupport === 'undefined') options.webWorkerSupport = true; // indexed-db\n\n  if (!options.idb) options.idb = {}; //  after this time the messages get deleted\n\n  if (!options.idb.ttl) options.idb.ttl = 1000 * 45;\n  if (!options.idb.fallbackInterval) options.idb.fallbackInterval = 150; //  handles abrupt db onclose events.\n\n  if (originalOptions.idb && typeof originalOptions.idb.onclose === 'function') options.idb.onclose = originalOptions.idb.onclose; // localstorage\n\n  if (!options.localstorage) options.localstorage = {};\n  if (!options.localstorage.removeTimeout) options.localstorage.removeTimeout = 1000 * 60; // custom methods\n\n  if (originalOptions.methods) options.methods = originalOptions.methods; // node\n\n  if (!options.node) options.node = {};\n  if (!options.node.ttl) options.node.ttl = 1000 * 60 * 2; // 2 minutes;\n\n  if (typeof options.node.useFastPath === 'undefined') options.node.useFastPath = true;\n  return options;\n}","/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n */\nimport { sleep, randomInt, randomToken, microSeconds as micro, isNode } from '../util.js';\nexport var microSeconds = micro;\nimport ObliviousSet from '../oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nvar DB_PREFIX = 'pubkey.broadcast-channel-0-';\nvar OBJECT_STORE_ID = 'messages';\nexport var type = 'idb';\nexport function getIdb() {\n  if (typeof indexedDB !== 'undefined') return indexedDB;\n\n  if (typeof window !== 'undefined') {\n    if (typeof window.mozIndexedDB !== 'undefined') return window.mozIndexedDB;\n    if (typeof window.webkitIndexedDB !== 'undefined') return window.webkitIndexedDB;\n    if (typeof window.msIndexedDB !== 'undefined') return window.msIndexedDB;\n  }\n\n  return false;\n}\nexport function createDatabase(channelName) {\n  var IndexedDB = getIdb(); // create table\n\n  var dbName = DB_PREFIX + channelName;\n  var openRequest = IndexedDB.open(dbName, 1);\n\n  openRequest.onupgradeneeded = function (ev) {\n    var db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: 'id',\n      autoIncrement: true\n    });\n  };\n\n  var dbPromise = new Promise(function (res, rej) {\n    openRequest.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    openRequest.onsuccess = function () {\n      res(openRequest.result);\n    };\n  });\n  return dbPromise;\n}\n/**\n * writes the new message to the database\n * so other readers can find it\n */\n\nexport function writeMessage(db, readerUuid, messageJson) {\n  var time = new Date().getTime();\n  var writeObject = {\n    uuid: readerUuid,\n    time: time,\n    data: messageJson\n  };\n  var transaction = db.transaction([OBJECT_STORE_ID], 'readwrite');\n  return new Promise(function (res, rej) {\n    transaction.oncomplete = function () {\n      return res();\n    };\n\n    transaction.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    var objectStore = transaction.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n  });\n}\nexport function getAllMessages(db) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        ret.push(cursor.value); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n        cursor[\"continue\"]();\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function getMessagesHigherThan(db, lastCursorId) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      var keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch (e) {\n      return objectStore.openCursor();\n    }\n  }\n\n  return new Promise(function (res) {\n    openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor[\"continue\"](lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor[\"continue\"]();\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function removeMessageById(db, id) {\n  var request = db.transaction([OBJECT_STORE_ID], 'readwrite').objectStore(OBJECT_STORE_ID)[\"delete\"](id);\n  return new Promise(function (res) {\n    request.onsuccess = function () {\n      return res();\n    };\n  });\n}\nexport function getOldMessages(db, ttl) {\n  var olderThen = new Date().getTime() - ttl;\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        var msgObk = cursor.value;\n\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n          cursor[\"continue\"]();\n        } else {\n          // no more old messages,\n          res(ret);\n          return;\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function cleanOldMessages(db, ttl) {\n  return getOldMessages(db, ttl).then(function (tooOld) {\n    return Promise.all(tooOld.map(function (msgObj) {\n      return removeMessageById(db, msgObj.id);\n    }));\n  });\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  return createDatabase(channelName).then(function (db) {\n    var state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName: channelName,\n      options: options,\n      uuid: randomToken(),\n\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parrallel\n      writeBlockPromise: Promise.resolve(),\n      messagesCallback: null,\n      readQueuePromises: [],\n      db: db\n    };\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n\n\n    _readLoop(state);\n\n    return state;\n  });\n}\n\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(function () {\n    return sleep(state.options.idb.fallbackInterval);\n  }).then(function () {\n    return _readLoop(state);\n  });\n}\n\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n\n  return true;\n}\n/**\n * reads all new messages from the database and emits them\n */\n\n\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return Promise.resolve(); // if no one is listening, we do not need to scan for new messages\n\n  if (!state.messagesCallback) return Promise.resolve();\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(function (newerMessages) {\n    var useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined some times\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */\n    .filter(function (msgObj) {\n      return !!msgObj;\n    }).map(function (msgObj) {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n\n      return msgObj;\n    }).filter(function (msgObj) {\n      return _filterMessage(msgObj, state);\n    }).sort(function (msgObjA, msgObjB) {\n      return msgObjA.time - msgObjB.time;\n    }); // sort by time\n\n    useMessages.forEach(function (msgObj) {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return Promise.resolve();\n  });\n}\n\nexport function close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\nexport function postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(function () {\n    return writeMessage(channelState.db, channelState.uuid, messageJson);\n  }).then(function () {\n    if (randomInt(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState.db, channelState.options.idb.ttl);\n    }\n  });\n  return channelState.writeBlockPromise;\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var idb = getIdb();\n  if (!idb) return false;\n  return true;\n}\nexport function averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nimport ObliviousSet from '../oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nimport { sleep, randomToken, microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nexport var type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexport function getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n\n  return localStorage;\n}\nexport function storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    sleep().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: randomToken(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nexport function addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n\n  window.addEventListener('storage', listener);\n  return listener;\n}\nexport function removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n\n  var uuid = randomToken();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n\n  };\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nexport function close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n\n  return true;\n}\nexport function averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n\n  return defaultTime;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","import { microSeconds as micro } from '../util';\nexport var microSeconds = micro;\nexport var type = 'simulate';\nvar SIMULATE_CHANNELS = new Set();\nexport function create(channelName) {\n  var state = {\n    name: channelName,\n    messagesCallback: null\n  };\n  SIMULATE_CHANNELS.add(state);\n  return state;\n}\nexport function close(channelState) {\n  SIMULATE_CHANNELS[\"delete\"](channelState);\n}\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    return setTimeout(function () {\n      var channelArray = Array.from(SIMULATE_CHANNELS);\n      channelArray.filter(function (channel) {\n        return channel.name === channelState.name;\n      }).filter(function (channel) {\n        return channel !== channelState;\n      }).filter(function (channel) {\n        return !!channel.messagesCallback;\n      }).forEach(function (channel) {\n        return channel.messagesCallback(messageJson);\n      });\n      res();\n    }, 5);\n  });\n}\nexport function onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  return true;\n}\nexport function averageResponseTime() {\n  return 5;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","import NativeMethod from './methods/native.js';\nimport IndexeDbMethod from './methods/indexed-db.js';\nimport LocalstorageMethod from './methods/localstorage.js';\nimport SimulateMethod from './methods/simulate.js';\nimport { isNode } from './util'; // order is important\n\nvar METHODS = [NativeMethod, // fastest\nIndexeDbMethod, LocalstorageMethod];\n/**\n * The NodeMethod is loaded lazy\n * so it will not get bundled in browser-builds\n */\n\nif (isNode) {\n  /**\n   * we use the non-transpiled code for nodejs\n   * because it runs faster\n   */\n  var NodeMethod = require('../../src/methods/' + // use this hack so that browserify and others\n  // do not import the node-method by default\n  // when bundling.\n  'node.js');\n  /**\n   * this will be false for webpackbuilds\n   * which will shim the node-method with an empty object {}\n   */\n\n\n  if (typeof NodeMethod.canBeUsed === 'function') {\n    METHODS.push(NodeMethod);\n  }\n}\n\nexport function chooseMethod(options) {\n  var chooseMethods = [].concat(options.methods, METHODS).filter(Boolean); // directly chosen\n\n  if (options.type) {\n    if (options.type === 'simulate') {\n      // only use simulate-method if directly chosen\n      return SimulateMethod;\n    }\n\n    var ret = chooseMethods.find(function (m) {\n      return m.type === options.type;\n    });\n    if (!ret) throw new Error('method-type ' + options.type + ' not found');else return ret;\n  }\n  /**\n   * if no webworker support is needed,\n   * remove idb from the list so that localstorage is been chosen\n   */\n\n\n  if (!options.webWorkerSupport && !isNode) {\n    chooseMethods = chooseMethods.filter(function (m) {\n      return m.type !== 'idb';\n    });\n  }\n\n  var useMethod = chooseMethods.find(function (method) {\n    return method.canBeUsed();\n  });\n  if (!useMethod) throw new Error('No useable methode found:' + JSON.stringify(METHODS.map(function (m) {\n    return m.type;\n  })));else return useMethod;\n}","import { isPromise } from './util.js';\nimport { chooseMethod } from './method-chooser.js';\nimport { fillOptionsWithDefaults } from './options.js';\nexport var BroadcastChannel = function BroadcastChannel(name, options) {\n  this.name = name;\n\n  if (ENFORCED_OPTIONS) {\n    options = ENFORCED_OPTIONS;\n  }\n\n  this.options = fillOptionsWithDefaults(options);\n  this.method = chooseMethod(this.options); // isListening\n\n  this._iL = false;\n  /**\n   * _onMessageListener\n   * setting onmessage twice,\n   * will overwrite the first listener\n   */\n\n  this._onML = null;\n  /**\n   * _addEventListeners\n   */\n\n  this._addEL = {\n    message: [],\n    internal: []\n  };\n  /**\n   * _beforeClose\n   * array of promises that will be awaited\n   * before the channel is closed\n   */\n\n  this._befC = [];\n  /**\n   * _preparePromise\n   */\n\n  this._prepP = null;\n\n  _prepareChannel(this);\n}; // STATICS\n\n/**\n * used to identify if someone overwrites\n * window.BroadcastChannel with this\n * See methods/native.js\n */\n\nBroadcastChannel._pubkey = true;\n/**\n * clears the tmp-folder if is node\n * @return {Promise<boolean>} true if has run, false if not node\n */\n\nexport function clearNodeFolder(options) {\n  options = fillOptionsWithDefaults(options);\n  var method = chooseMethod(options);\n\n  if (method.type === 'node') {\n    return method.clearNodeFolder().then(function () {\n      return true;\n    });\n  } else {\n    return Promise.resolve(false);\n  }\n}\n/**\n * if set, this method is enforced,\n * no mather what the options are\n */\n\nvar ENFORCED_OPTIONS;\nexport function enforceOptions(options) {\n  ENFORCED_OPTIONS = options;\n} // PROTOTYPE\n\nBroadcastChannel.prototype = {\n  postMessage: function postMessage(msg) {\n    if (this.closed) {\n      throw new Error('BroadcastChannel.postMessage(): ' + 'Cannot post message after channel has closed');\n    }\n\n    return _post(this, 'message', msg);\n  },\n  postInternal: function postInternal(msg) {\n    return _post(this, 'internal', msg);\n  },\n\n  set onmessage(fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _removeListenerObject(this, 'message', this._onML);\n\n    if (fn && typeof fn === 'function') {\n      this._onML = listenObj;\n\n      _addListenerObject(this, 'message', listenObj);\n    } else {\n      this._onML = null;\n    }\n  },\n\n  addEventListener: function addEventListener(type, fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _addListenerObject(this, type, listenObj);\n  },\n  removeEventListener: function removeEventListener(type, fn) {\n    var obj = this._addEL[type].find(function (obj) {\n      return obj.fn === fn;\n    });\n\n    _removeListenerObject(this, type, obj);\n  },\n  close: function close() {\n    var _this = this;\n\n    if (this.closed) return;\n    this.closed = true;\n    var awaitPrepare = this._prepP ? this._prepP : Promise.resolve();\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare.then(function () {\n      return Promise.all(_this._befC.map(function (fn) {\n        return fn();\n      }));\n    }).then(function () {\n      return _this.method.close(_this._state);\n    });\n  },\n\n  get type() {\n    return this.method.type;\n  }\n\n};\n\nfunction _post(broadcastChannel, type, msg) {\n  var time = broadcastChannel.method.microSeconds();\n  var msgObj = {\n    time: time,\n    type: type,\n    data: msg\n  };\n  var awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : Promise.resolve();\n  return awaitPrepare.then(function () {\n    return broadcastChannel.method.postMessage(broadcastChannel._state, msgObj);\n  });\n}\n\nfunction _prepareChannel(channel) {\n  var maybePromise = channel.method.create(channel.name, channel.options);\n\n  if (isPromise(maybePromise)) {\n    channel._prepP = maybePromise;\n    maybePromise.then(function (s) {\n      // used in tests to simulate slow runtime\n\n      /*if (channel.options.prepareDelay) {\n           await new Promise(res => setTimeout(res, this.options.prepareDelay));\n      }*/\n      channel._state = s;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\n\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\n\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n\n  _startListening(channel);\n}\n\nfunction _removeListenerObject(channel, type, obj) {\n  channel._addEL[type] = channel._addEL[type].filter(function (o) {\n    return o !== obj;\n  });\n\n  _stopListening(channel);\n}\n\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    // someone is listening, start subscribing\n    var listenerFn = function listenerFn(msgObj) {\n      channel._addEL[msgObj.type].forEach(function (obj) {\n        if (msgObj.time >= obj.time) {\n          obj.fn(msgObj.data);\n        }\n      });\n    };\n\n    var time = channel.method.microSeconds();\n\n    if (channel._prepP) {\n      channel._prepP.then(function () {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\n\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    // noone is listening, stop subscribing\n    channel._iL = false;\n    var time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}","import { BroadcastChannel } from 'broadcast-channel'\nimport { QueryClient } from '../core'\n\ninterface BroadcastQueryClientOptions {\n  queryClient: QueryClient\n  broadcastChannel?: string\n}\n\nexport function broadcastQueryClient({\n  queryClient,\n  broadcastChannel = 'react-query',\n}: BroadcastQueryClientOptions) {\n  let transaction = false\n  const tx = (cb: () => void) => {\n    transaction = true\n    cb()\n    transaction = false\n  }\n\n  const channel = new BroadcastChannel(broadcastChannel, {\n    webWorkerSupport: false,\n  })\n\n  const queryCache = queryClient.getQueryCache()\n\n  queryClient.getQueryCache().subscribe(queryEvent => {\n    if (transaction) {\n      return\n    }\n\n    const {\n      query: { queryHash, queryKey, state },\n    } = queryEvent\n\n    if (queryEvent.type === 'updated' && queryEvent.action.type === 'success') {\n      channel.postMessage({\n        type: 'updated',\n        queryHash,\n        queryKey,\n        state,\n      })\n    }\n\n    if (queryEvent.type === 'removed') {\n      channel.postMessage({\n        type: 'removed',\n        queryHash,\n        queryKey,\n      })\n    }\n  })\n\n  channel.onmessage = action => {\n    if (!action?.type) {\n      return\n    }\n\n    tx(() => {\n      const { type, queryHash, queryKey, state } = action\n\n      if (type === 'updated') {\n        const query = queryCache.get(queryHash)\n\n        if (query) {\n          query.setState(state)\n          return\n        }\n\n        queryCache.build(\n          queryClient,\n          {\n            queryKey,\n            queryHash,\n          },\n          state\n        )\n      } else if (type === 'removed') {\n        const query = queryCache.get(queryHash)\n\n        if (query) {\n          queryCache.remove(query)\n        }\n      }\n    })\n  }\n}\n"],"names":["isPromise","obj","then","sleep","time","Promise","res","setTimeout","randomInt","min","max","Math","floor","random","randomToken","toString","substring","lastMs","additional","microSeconds","ms","Date","getTime","isNode","Object","prototype","call","process","micro","type","create","channelName","state","messagesCallback","bc","BroadcastChannel","subFns","onmessage","msg","data","close","channelState","postMessage","messageJson","onMessage","fn","canBeUsed","window","_pubkey","Error","averageResponseTime","ObliviousSet","ttl","set","Set","timeMap","Map","has","bind","add","value","now","_removeTooOldValues","clear","olderThen","iterator","Symbol","next","get","fillOptionsWithDefaults","originalOptions","arguments","length","undefined","options","JSON","parse","stringify","webWorkerSupport","idb","fallbackInterval","onclose","localstorage","removeTimeout","methods","node","useFastPath","DB_PREFIX","OBJECT_STORE_ID","getIdb","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","createDatabase","IndexedDB","dbName","openRequest","open","onupgradeneeded","ev","db","target","result","createObjectStore","keyPath","autoIncrement","dbPromise","rej","onerror","onsuccess","writeMessage","readerUuid","writeObject","uuid","transaction","oncomplete","objectStore","getMessagesHigherThan","lastCursorId","ret","openCursor","keyRangeValue","IDBKeyRange","bound","Infinity","e","cursor","id","push","removeMessageById","request","getOldMessages","msgObk","cleanOldMessages","tooOld","all","map","msgObj","closed","eMIs","writeBlockPromise","resolve","readQueuePromises","_readLoop","readNewMessages","_filterMessage","messagesCallbackTime","newerMessages","useMessages","filter","sort","msgObjA","msgObjB","forEach","KEY_PREFIX","getLocalStorage","localStorage","storageKey","key","writeObj","token","setItem","document","createEvent","initEvent","newValue","dispatchEvent","addStorageEventListener","listener","addEventListener","removeStorageEventListener","removeEventListener","ls","removeItem","defaultTime","userAgent","navigator","toLowerCase","includes","SIMULATE_CHANNELS","name","channelArray","Array","from","channel","METHODS","NativeMethod","IndexeDbMethod","LocalstorageMethod","NodeMethod","require","chooseMethod","chooseMethods","concat","Boolean","SimulateMethod","find","m","useMethod","method","ENFORCED_OPTIONS","_iL","_onML","_addEL","message","internal","_befC","_prepP","_prepareChannel","_post","postInternal","listenObj","_removeListenerObject","_addListenerObject","_this","awaitPrepare","_state","broadcastChannel","maybePromise","s","_hasMessageListeners","_startListening","o","_stopListening","listenerFn","broadcastQueryClient","queryClient","tx","cb","queryCache","getQueryCache","subscribe","queryEvent","query","queryHash","queryKey","action","setState","build","remove"],"mappings":"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"}