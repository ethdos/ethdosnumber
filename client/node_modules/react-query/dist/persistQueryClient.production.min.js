!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactQueryPersistQueryClient={},e.React)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t);function u(e){return e.state.isPaused}function s(e){return"success"===e.state.status}function i(e,t={}){const n=[],r=[];if(!1!==t.dehydrateMutations){const r=t.shouldDehydrateMutation||u;e.getMutationCache().getAll().forEach((e=>{r(e)&&n.push(function(e){return{mutationKey:e.options.mutationKey,state:e.state}}(e))}))}if(!1!==t.dehydrateQueries){const n=t.shouldDehydrateQuery||s;e.getQueryCache().getAll().forEach((e=>{n(e)&&r.push(function(e){return{state:e.state,queryKey:e.queryKey,queryHash:e.queryHash}}(e))}))}return{mutations:n,queries:r}}async function a({queryClient:e,persister:t,maxAge:n=864e5,buster:r="",hydrateOptions:u}){try{const s=await t.restoreClient();if(s)if(s.timestamp){const i=Date.now()-s.timestamp>n,a=s.buster!==r;i||a?t.removeClient():function(e,t,n){if("object"!=typeof t||null===t)return;const r=e.getMutationCache(),u=e.getQueryCache(),s=t.mutations||[],i=t.queries||[];s.forEach((t=>{var u;r.build(e,{...null==n||null==(u=n.defaultOptions)?void 0:u.mutations,mutationKey:t.mutationKey},t.state)})),i.forEach((t=>{var r;const s=u.get(t.queryHash);s?s.state.dataUpdatedAt<t.state.dataUpdatedAt&&s.setState(t.state):u.build(e,{...null==n||null==(r=n.defaultOptions)?void 0:r.queries,queryKey:t.queryKey,queryHash:t.queryHash},t.state)}))}(e,s.clientState,u)}else t.removeClient()}catch(e){t.removeClient()}}async function o({queryClient:e,persister:t,buster:n="",dehydrateOptions:r}){const u={buster:n,timestamp:Date.now(),clientState:i(e,r)};await t.persistClient(u)}function c(e){const t=e.queryClient.getQueryCache().subscribe((()=>{o(e)})),n=e.queryClient.getMutationCache().subscribe((()=>{o(e)}));return()=>{t(),n()}}function l(e){let t,n=!1;return[()=>{n=!0,null==t||t()},a(e).then((()=>{n||(t=c(e))}))]}function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}const f=r.default.createContext(void 0),y=r.default.createContext(!1);const p=({client:e,children:t,context:n,contextSharing:u=!1})=>{r.default.useEffect((()=>(e.mount(),()=>{e.unmount()})),[e]);const s=function(e,t){return e||(t&&"undefined"!=typeof window?(window.ReactQueryClientContext||(window.ReactQueryClientContext=f),window.ReactQueryClientContext):f)}(n,u);return r.default.createElement(y.Provider,{value:!n&&u},r.default.createElement(s.Provider,{value:e},t))},h=r.default.createContext(!1).Provider;e.PersistQueryClientProvider=({client:e,children:t,persistOptions:n,onSuccess:u,...s})=>{const[i,a]=r.default.useState(!0),o=r.default.useRef({persistOptions:n,onSuccess:u});return r.default.useEffect((()=>{o.current={persistOptions:n,onSuccess:u}})),r.default.useEffect((()=>{let t=!1;a(!0);const[n,r]=l({...o.current.persistOptions,queryClient:e});return r.then((()=>{t||(null==o.current.onSuccess||o.current.onSuccess(),a(!1))})),()=>{t=!0,n()}}),[e]),r.default.createElement(p,d({client:e},s),r.default.createElement(h,{value:i},t))},e.persistQueryClient=l,e.persistQueryClientRestore=a,e.persistQueryClientSave=o,e.persistQueryClientSubscribe=c,e.removeOldestQuery=({persistedClient:e})=>{const t=[...e.clientState.mutations],n=[...e.clientState.queries],r={...e,clientState:{mutations:t,queries:n}},u=[...n].sort(((e,t)=>e.state.dataUpdatedAt-t.state.dataUpdatedAt));if(u.length>0){const e=u.shift();return r.clientState.queries=n.filter((t=>t!==e)),r}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=persistQueryClient.production.min.js.map
